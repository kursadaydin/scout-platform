<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Scout Platform{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Static CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Favicon -->
    <link rel="icon" href="/static/favicon.ico">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">

            <a class="navbar-brand" href="/">Scout Platform</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

            <div class="collapse navbar-collapse" id="navbarNav">

                <!-- Sol menü -->
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/player_detail">Player Detail</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/teams">Teams</a>
                    </li>
                    <!-- Orta: Futbolcu Arama -->
                    <div class="position-relative me-3" style="min-width: 220px;">
                        <input id="player-search" class="form-control form-control-sm" type="search" placeholder="Futbolcu ara...">
                        <div id="search-results" class="dropdown-menu show w-100 d-none" style="max-height:300px; overflow-y:auto;">
                        </div>
                    </div>
                </ul>

                <!-- Sağ menü -->
                <ul class="navbar-nav">

                    {% if user %}
                    <!-- Kullanıcı dropdown -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        {{ user.split("@")[0] }}
                    </a>

                        <ul class="dropdown-menu dropdown-menu-end">
                            <li class="dropdown-item-text text-muted small">
                                {{ user }}
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li>
                                <a class="dropdown-item text-danger" href="/auth/logout">
                                Çıkış Yap
                            </a>
                            </li>
                        </ul>
                    </li>

                    {% else %}
                    <!-- Login -->
                    <li class="nav-item">
                        <a class="nav-link" href="/login">Login</a>
                    </li>
                    {% endif %}

                </ul>
            </div>
        </div>
    </nav>


    <div class="container-fluid">
        <div class="row justify-content-center">
            <!-- Sol boşluk -->
            <div class="col-0 col-md-2 d-none d-md-block"></div>

            <!-- Orta içerik -->
            <div class="col-12 col-md-8">
                <div id="main-content">
                    <div class="container mt-4">
                        <div id="main-content">
                            <!-- Page Content -->
                            <div class="container mt-4">
                                {% block content %}{% endblock %}
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-0 col-md-2 d-none d-md-block"></div>
        </div>
    </div>
</body>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


<!-- Static JS -->
<script src="/static/js/main.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        const searchInput = document.getElementById("player-search");
        const resultsBox = document.getElementById("search-results");

        if (!searchInput || !resultsBox) {
            console.warn("Search elements not found");
            return;
        }

        let debounceTimer = null;

        searchInput.addEventListener("input", () => {
            const q = searchInput.value.trim();

            resultsBox.innerHTML = "";
            resultsBox.classList.add("d-none");
            resultsBox.classList.add("show");

            if (q.length < 3) return;

            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(async() => {
                try {
                    const res = await fetch(`/api/players/autocomplete?q=${encodeURIComponent(q)}`);
                    const names = await res.json();

                    if (!names.length) return;

                    resultsBox.classList.remove("d-none");
                    resultsBox.classList.add("show");

                    names.forEach(name => {
                        const item = document.createElement("button");
                        item.type = "button";
                        item.className = "dropdown-item";
                        item.textContent = name;

                        item.onclick = () => {
                            window.location.href = `/?name=${encodeURIComponent(name)}`;
                        };

                        resultsBox.appendChild(item);
                    });

                } catch (err) {
                    console.error("Autocomplete error:", err);
                }
            }, 300);
        });

        document.addEventListener("click", (e) => {
            if (!e.target.closest(".position-relative")) {
                resultsBox.classList.add("d-none");
            }
        });

    });
</script>

</html>